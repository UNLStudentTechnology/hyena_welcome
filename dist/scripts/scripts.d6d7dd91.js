"use strict";angular.module("hyenaWelcomeApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","hyenaAngular"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("unl-layout",{templateUrl:"views/layouts/unl-layout.html",data:{requireAuth:!0}}).state("unl-layout-fullscreen",{templateUrl:"views/layouts/unl-layout-fullscreen.html",data:{requireAuth:!1}}).state("unl-layout-kiosk",{templateUrl:"views/layouts/unl-layout-kiosk.html",data:{requireAuth:!1}}).state("unl-layout-kiosk.kiosk",{url:"/:groupId/kiosk",templateUrl:"views/kiosk.html",controller:"KioskCtrl"}).state("unl-layout-kiosk.kiosk.people",{url:"/people",templateUrl:"views/kiosk/people.html"}).state("unl-layout-kiosk.kiosk.calendar",{url:"/calendar",templateUrl:"views/kiosk/calendar.html"}).state("unl-layout-kiosk.kiosk.signin",{url:"/signin",templateUrl:"views/kiosk/signin.html"}).state("unl-layout-kiosk.kiosk.message",{url:"/message",templateUrl:"views/kiosk/message.html"}).state("unl-layout.new_location",{url:"/:groupId/location/new",templateUrl:"views/new_location.html",controller:"NewLocationCtrl"}).state("unl-layout.location",{url:"/:groupId/location/:locationId",templateUrl:"views/location.html",controller:"LocationCtrl"}).state("unl-layout.main",{url:"/:groupId",templateUrl:"views/main.html",controller:"MainCtrl"}).state("unl-layout.new",{url:"/:groupId/board/new",templateUrl:"views/new.html",controller:"NewCtrl"}),b.otherwise("/"),c.html5Mode(!0)}]).config(["$httpProvider",function(a){a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]).constant("FBURL","https://hyena-welcome.firebaseio.com/").constant("APIKEY","OTA2MmRmMDlmZGFmNWY1MTcwMmVhZDVk").constant("APIPATH","https://itsgethelp.unl.edu/public/api/1.0/").constant("PLATFORM_ROOT","https://itsgethelp.unl.edu/public/").constant("AUTH_SCOPE","groups"),angular.module("hyenaWelcomeApp").controller("MainCtrl",["$scope","$rootScope","$stateParams","FirebaseGroupService","LocationService",function(a,b,c,d,e){var f=c.groupId;if(a.groupId=b.currentGroupId=f,angular.isDefined(f)&&""!==f&&d.existsOrAdd(f),f){a.locations=e.groupLocations(f,10).$asArray();var g=d.get(f).$asObject();g.$bindTo(a,"group")}}]),angular.module("hyenaWelcomeApp").controller("KioskCtrl",["$scope","$stateParams","$rootScope","$location","LocationService","GroupService","UserService","EmailService","Notification",function(a,b,c,d,e,f,g,h,i){var j={selectedUser:null,loadingContent:!1,kioskNuid:"",authUser:null};a.processData=angular.copy(j);var k=b.groupId;a.groupId=c.currentGroupId=k,(angular.isUndefined(a.processData.selectedUser)||null===a.processData.selectedUser)&&d.path(k+"/kiosk/people"),f.get(k,"users").then(function(b){a.group=b.data,a.members=b.data.users},function(a){i.show("Sorry! Unable to load your group.","error")}),a.memberStatus=e.getUsersByGroup(k).$asObject(),a.selectUser=function(b){a.processData.selectedUser=b},a.validateAndGet=function(){a.processData.loadingContent=!0,g.validateAndGet(a.processData.kioskNuid).then(function(b){i.show("Hello, "+b.first_name+"!","success"),a.processData.authUser=b,a.processData.loadingContent=!1},function(b){console.log(b),angular.isDefined(b.message)?i.show(b.message,"error"):i.show("Sorry! Unable to find a user with that NUID.","error"),a.processData.loadingContent=!1})},a.sendMessage=function(){h.send(a.processData.selectedUser.email,a.processData.selectedUser.first_name,"Message from "+a.processData.authUser.first_name+" "+a.processData.authUser.last_name,a.processData.messageToUser,k).then(function(a){i.show("Your message was sent successfully.","success")},function(a){i.show(a.message,"error"),console.log("Unable to send email",a)}),a.startOver()},a.startOver=function(){a.processData=angular.copy(j),d.path(k+"/kiosk/people")}}]),angular.module("hyenaWelcomeApp").service("BoardService",["$firebase","$q","AppFirebase",function(a,b,c){var d=c.getRef(),e={get:function(b){return b=b.trim(),a(d.child("/boards/"+b))},groupBoards:function(b,c){c=c||20,b=parseInt(b);var e=d.child("boards").orderByChild("group_id").equalTo(b).limitToFirst(c);return a(e)},add:function(b,c){return a(d.child("boards")).$push(b).then(function(b){return a(d.child("/groups/"+c+"/boards")).$set(b.key(),!0),b})}};return e}]),angular.module("hyenaWelcomeApp").controller("NewCtrl",["$scope","$stateParams","$rootScope","BoardService","Notification",function(a,b,c,d,e){var f=b.groupId;a.groupId=c.currentGroupId=f,a.board={created_at:moment().format(),group_id:parseInt(f),title:"",active:1},a.createBoard=function(){d.add(a.board,f).then(function(b){console.log(b);var c=b.key();a.go("/"+f+"/board/"+c),e.show("Your board has been created successfully!","success")},function(a){console.log("Create Board Error",a),e.show("There was an error creating your board.","error")})}}]),angular.module("hyenaWelcomeApp").controller("BoardCtrl",["$scope","$stateParams","$rootScope","BoardService","Notification",function(a,b,c,d,e){var f=b.groupId;a.groupId=c.currentGroupId=f;var g=a.boardId=b.boardId,h=d.get(g).$asObject();h.$bindTo(a,"board")}]),angular.module("hyenaWelcomeApp").controller("NewLocationCtrl",["$scope","$stateParams","$rootScope","Notification","LocationService",function(a,b,c,d,e){var f=b.groupId;a.groupId=c.currentGroupId=f,a.location={created_at:moment().format(),group_id:parseInt(f),title:"",proximity_uuid:"",beacon_major:1,active:1},a.createLocation=function(){e.add(a.location,f).then(function(b){console.log(b),a.go("^.main",{groupId:f}),d.show("Your location has been created successfully!","success")},function(a){console.log("Create Location Error",a),d.show("There was an error creating your location.","error")})}}]),angular.module("hyenaWelcomeApp").service("LocationService",["$firebase","$q","AppFirebase",function(a,b,c){var d=c.getRef(),e={get:function(b){return b=b.trim(),a(d.child("/locations/"+b))},groupLocations:function(b,c){c=c||20,b=parseInt(b);var e=d.child("locations").orderByChild("group_id").equalTo(b).limitToFirst(c);return a(e)},add:function(b,c){return a(d.child("locations")).$push(b).then(function(b){return a(d.child("/groups/"+c+"/locations")).$set(b.key(),!0),b})},getUser:function(b){return a(d.child("/users/"+b))},getUsersByGroup:function(b){return a(d.child("groups/"+b+"/users"))}};return e}]),angular.module("hyenaWelcomeApp").controller("LocationCtrl",["$scope","$stateParams","$rootScope","LocationService","Notification",function(a,b,c,d,e){var f=b.groupId;a.groupId=c.currentGroupId=f;var g=a.locationId=b.locationId,h=d.get(g).$asObject();h.$bindTo(a,"location")}]),angular.module("hyenaWelcomeApp").directive("locationInfo",["LocationService",function(a){return{restrict:"A",scope:{userValue:"=locationUser"},link:function(b,c,d){b.$watch("userValue",function(c,d){angular.isDefined(c)&&angular.isObject(c)&&a.getUser(c.uni_auth).$asObject().$loaded().then(function(a){b.userValue=angular.extend(c,a)},function(a){console.log("Location Error",a)})})}}}]);